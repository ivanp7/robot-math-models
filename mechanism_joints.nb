(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[      6897,        201]
NotebookOptionsPosition[      6493,        185]
NotebookOutlinePosition[      6835,        200]
CellTagsIndexPosition[      6792,        197]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"**", "**"}], "**"}], "**"}], "**"}], "**"}], 
                  "**"}], "**"}], "**"}], "**"}], "**"}], "**"}], "**"}], 
           "**"}], "**"}], "**"}], "**", "**", "**", "**"}], "**"}], "**"}], 
     "**"}], "**"}], "*******)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "**", "\:0412\:0441\:043f\:043e\:043c\:043e\:0433\:0430\:0442\:0435\:043b\
\:044c\:043d\:044b\:0435"}], " ", 
    "\:0444\:0443\:043d\:043a\:0446\:0438\:0438", " ", "\:0434\:043b\:044f", 
    " ", "\:0437\:0430\:0434\:0430\:043d\:0438\:044f", " ", 
    "\:043a\:0438\:043d\:0435\:043c\:0430\:0442\:0438\:043a\:0438", " ", 
    "\:043c\:0435\:0445\:0430\:043d\:0438\:0437\:043c\:043e\:0432"}], 
   "***)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"**", "**", "**", "**", "**", "**", "**", "**"}], 
               "**"}], "**"}], "**"}], "**"}], "**"}], "**"}], "**"}], "**", "**",
         "**", "**", "**"}], "**"}], "**"}], "**"}], "**"}], 
   "*******)"}]}]], "Input",
 CellChangeTimes->{{3.718705641735167*^9, 
  3.7187057178232975`*^9}},ExpressionUUID->"46315571-acec-4123-bcb6-\
2624cb3fbe11"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "\:041e\:0441\:0438", " ", 
    "\:0448\:0430\:0440\:043d\:0438\:0440\:043e\:0432"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"jointAxis", "[", 
      RowBox[{"axis_", ",", "prevquat_"}], "]"}], ":=", 
     RowBox[{"rotateByQ", "[", 
      RowBox[{"axis", ",", "prevquat"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "\:041f\:043e\:0432\:043e\:0440\:043e\:0442\:044b", " ", "\:0432", " ", 
     "\:0448\:0430\:0440\:043d\:0438\:0440\:0430\:0445"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"revoluteJointQuat", "[", 
      RowBox[{
      "angVar_", ",", "jointAxisFn_", ",", "prevQuatFn_", ",", "basequat_"}], 
      "]"}], ":=", 
     RowBox[{
      RowBox[{"quatMult", "[", 
       RowBox[{
        RowBox[{"rotQuat", "[", 
         RowBox[{"angVar", ",", 
          RowBox[{"jointAxisFn", "[", 
           RowBox[{"prevQuatFn", "[", "basequat", "]"}], "]"}]}], "]"}], ",", 
        RowBox[{"prevQuatFn", "[", "basequat", "]"}]}], "]"}], "//", 
      "Simplify"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"universalJointQuat", "[", 
      RowBox[{
      "angVars_", ",", "jointAxisFns_", ",", "prevQuatFn_", ",", 
       "basequat_"}], "]"}], ":=", 
     RowBox[{"revoluteJointQuat", "[", 
      RowBox[{
       RowBox[{"angVars", "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", 
       RowBox[{"jointAxisFns", "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"revoluteJointQuat", "[", 
         RowBox[{
          RowBox[{"angVars", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"jointAxisFns", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", "prevQuatFn", ",", "#"}], 
         "]"}], "&"}], ",", "basequat"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"sphericalJointQuat", "[", 
      RowBox[{
      "angVars_", ",", "jointAxisFns_", ",", "prevQuatFn_", ",", 
       "basequat_"}], "]"}], ":=", 
     RowBox[{"revoluteJointQuat", "[", 
      RowBox[{
       RowBox[{"angVars", "[", 
        RowBox[{"[", "3", "]"}], "]"}], ",", 
       RowBox[{"jointAxisFns", "[", 
        RowBox[{"[", "3", "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"universalJointQuat", "[", 
         RowBox[{
          RowBox[{"angVars", "[", 
           RowBox[{"[", 
            RowBox[{"1", ";;", "2"}], "]"}], "]"}], ",", 
          RowBox[{"jointAxisFns", "[", 
           RowBox[{"[", 
            RowBox[{"1", ";;", "2"}], "]"}], "]"}], ",", "prevQuatFn", ",", 
          "#"}], "]"}], "&"}], ",", "basequat"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "\:041a\:043e\:043e\:0440\:0434\:0438\:043d\:0430\:0442\:044b", " ", 
     "\:0448\:0430\:0440\:043d\:0438\:0440\:043e\:0432"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"jointCoord", "[", 
      RowBox[{
      "prevCoordFn_", ",", "prevQuatFn_", ",", "lastChainVector_", ",", 
       "basequat_", ",", "baserefl_", ",", "basedispl_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"prevCoordFn", "[", 
        RowBox[{"basequat", ",", "baserefl", ",", "basedispl"}], "]"}], "+", 
       RowBox[{"baserefl", "*", 
        RowBox[{"rotateByQ", "[", 
         RowBox[{"lastChainVector", ",", 
          RowBox[{"prevQuatFn", "[", "basequat", "]"}]}], "]"}]}]}], "//", 
      "Simplify"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.713169498290124*^9, 3.7131695935598793`*^9}, {
  3.7131700329322977`*^9, 3.713170045300627*^9}, {3.713248399784254*^9, 
  3.7132484003880787`*^9}, {3.713249376423192*^9, 3.7132493990802555`*^9}, {
  3.713249439414153*^9, 3.713249583707095*^9}, {3.713250143561164*^9, 
  3.7132501465683675`*^9}, {3.7132503047086954`*^9, 3.7132503480113864`*^9}, {
  3.713258000255291*^9, 3.7132580014213734`*^9}, {3.718705600194661*^9, 
  3.718705610644181*^9}},ExpressionUUID->"de3748c1-27dd-4a47-920c-\
b92f19c1fbe2"]
},
WindowSize->{879, 977},
WindowMargins->{{79, Automatic}, {Automatic, 6}},
FrontEndVersion->"11.1 for Microsoft Windows (64-bit) (March 13, 2017)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 1805, 55, 69, "Input", "ExpressionUUID" -> \
"46315571-acec-4123-bcb6-2624cb3fbe11"],
Cell[2366, 77, 4123, 106, 335, "Input", "ExpressionUUID" -> \
"de3748c1-27dd-4a47-920c-b92f19c1fbe2"]
}
]
*)

